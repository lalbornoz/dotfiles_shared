execute pathogen#infect()

" {{{ [Options ] Nocompatible
"
" This is a special kind of option, because when it's set or reset, other
" options are also changed as a side effect.  CAREFUL: Setting or resetting
" this option can have a lot of unexpected effects: Mappings are interpreted
" in another way, undo behaves differently, etc.  If you set this option in
" your vimrc file, you should probably put it at the very start.
"
" [ ... ]
"
" When a |vimrc| or |gvimrc| file is found while Vim is starting up, this option
" is switched off, and all options that have not been modified will be set to
" the Vim defaults.  Effectively, this means that when a |vimrc| or |gvimrc|
" file exists, Vim will use the Vim defaults, otherwise it will use the Vi
" defaults.  (Note: This doesn't happen for the system-wide vimrc or gvimrc
" file, nor for a file given with the |-u| argument).
"
set nocompatible
" }}}
" {{{ [Options ] Defaults
filet on | filet plugin on			" Enable file type detection, load plugin files
let g:VM_leader=';'
let mapleader=';'
set bs=2					" Backspace over indent,eol,start
set cursorcolumn cursorline			" Highlight the screen {column,line} of the cursor
set encoding=utf-8				" Global UTF-8 character encoding
set ignorecase					" Ignore case when searching
set incsearch nohlsearch			" Incremental search, no match highlighting
set laststatus=2 noshowmode			" Last window always has status line, don't show mode in last line
set modeline					" Parse {vi{,m}, ex} (1) modelines
set mouse=a					" Enable the use of the mouse for all modes
set nobackup nowritebackup			" Don't write backups for existing files
set nocindent nosmartindent			" Disable {C, Smart} indenting
set noexpandtab sw=8 ts=8			" No VT, shift width, tab stops
set noundofile					" Do not automatically saves undo history
set nowrap					" Don't wrap long lines
set number					" Show line numbers
set showcmd					" Show (partial) command in the last line
set t_Co=256					" Force 256 colour terminal
set tw=125					" Maximum width of text that is being inserted
set viminfo=""					" Neither read nor write /viminfo/ file
set virtualedit=block				" Allow virtual editing in Visual block mode
set wildmode=longest,list,full			" Completion mode [for] wildcard expansion in the command-line
" }}}
" {{{ [Options ] Autocommands and abbreviations
autocmd	FileType	gitcommit	set	textwidth=0
autocmd	FileType	netrw		setl	bufhidden=wipe
autocmd	FileType	perl		syntax	off
autocmd QuickFixCmdPost	[^l]* nested	cwindow
autocmd QuickFixCmdPost	   l* nested	lwindow
autocmd	WinEnter	*		set	cursorcolumn cursorline
autocmd	WinLeave	*		set	nocursorcolumn nocursorline
cnoreabbrev W		w
" }}}
" {{{ [Options ] Conditionals
if has("folding")	| set foldmethod=marker commentstring=/*\ %s\ */	| endif
if has("quickfix")	| set errorformat^=%+G/tmp/%.%# |
			  set errorformat^=%+GMakefile:%\\d%#:\ recipe\ %.%#\ failed |
			  endif
if has("statusline")	| set ruler | set rulerformat=%15(%l,%c%V\ %P%)		| endif
if has("syntax")	| syntax on | colors gruvbox | set background=dark	| endif
" }}}
" {{{ [Options ] Plugins
let g:filesearch_autodismiss_on_select = 0	" Selecting an entry with <CR> will not close the catalog
let g:filesearch_viewport_split_policy = "B"	" Horizontal bottom (full screen width)
let g:buffergator_suppress_keymaps = 1		" Do not automatically map <Leader> keys
let g:LargeFile = 10				" The minimum size of a file needed for it to be
let g:lightline = {
	\ 'active': {
	\	'right': [ [ 'lineinfo_full' ],
	\		   [ 'percent' ],
	\		   [ 'fileformat', 'fileencoding', 'filetype' ] ]
	\ },
	\ 'component': {
	\	'lineinfo_full': '%l,%c%V/%L %P'
	\ },
	\ }
let g:netrw_banner = 0				" Suppress the [netrw] banner
let g:netrw_browse_split = 0			" When browsing, <cr> will open the file by re-using the same window
let g:netrw_dirhistmax = 0			" Suppress [netrw] history
let g:netrw_liststyle = 3			" Set the default listing style [to] tree style listing
let g:netrw_winsize = 25			" Specify initial size of new windows
" }}}
" {{{ [Options ] Plugins (LSP)
let g:lsp_diagnostics_echo_cursor = 1
let g:lsp_settings = {
	\ 'clangd': {
	\	'cmd': ['clangd', '--background-index', '--pch-storage=memory']
	\ }
	\ }

if 0
	let g:lsp_log_file = expand('$HOME/.vim/lsp.log')
	let g:lsp_log_verbose = 1
endif
if executable('pyls')
    au User lsp_setup call lsp#register_server({
        \ 'name':	'pyls',
        \ 'cmd':	{server_info->['pyls', '--verbose', '--log-file', expand('$HOME/.vim/pyls.log')]},
        \ 'whitelist':	['python'],
        \ })
endif
" }}}

" {{{ [Mappings] Function key aliases
map <Esc>[11~		<F1>
map <Esc>[12~		<F2>
map <Esc>[13~		<F3>
map <Esc>[14~		<F4>
map <Esc>[15~		<F5>
map <Esc>[17~		<F6>
map <Esc>[18~		<F7>
map <Esc>[19~		<F8>
map <Esc>[20~		<F9>
map <Esc>[21~		<F10>
map <Esc>[23~		<F11>
map <Esc>[24~		<F12>

map <Esc>[25~		<S-F3>
map <Esc>[26~		<S-F4>
map <Esc>[28~		<S-F5>
map <Esc>[29~		<S-F6>
map <Esc>[31~		<S-F7>
map <Esc>[32~		<S-F8>
map <Esc>[33~		<S-F9>
map <Esc>[34~		<S-F10>
" }}}
"
" {{{ [Mappings] Autocomplete & LSP
inoremap <expr> <cr>	pumvisible() ? asyncomplete#close_popup() . "\<cr>" : "\<cr>"
inoremap <expr> <Tab>	"\<Tab>"
inoremap <expr> <S-Tab>	pumvisible() ? "\<C-n>" : "\<S-Tab>"
" }}}
" {{{ [Mappings] Function keys
" LSP & QuickFix function hotkeys
map <F1>		:<C-U>LspPeekDeclaration<cr>
map <F2>		:<C-U>LspPeekDefinition<cr>
map <F3>		:<C-U>LspDeclaration<cr>
map <S-F3>		:<C-U>leftabove LspDeclaration<cr>
map <F4>		:<C-U>LspDefinition<cr>
map <S-F4>		:<C-U>leftabove LspDefinition<cr>
map <F5>		:<C-U>LspReferences<cr>
map <S-F5>		:<C-U>LspWorkspaceSymbol<cr>
map <F6>		:<C-U>LspHover<cr>
map <S-F6>		:<C-U>silent make\|redraw!\|cc<cr>

" Tab & window management function hotkeys
map <F7>		:<C-U>new<cr>
map <S-F7>		:<C-U>vnew<cr>
map <F8>		:<C-U>tabnew<cr>
map <S-F8>		:<C-U>close<cr>

" Buffer, filesystem & OS integration function hotkeys
map <F9>		:<C-U>Man 
map <S-F9>		"zyiw:exe "Man ".@z.""<cr>
map <F10>		:<C-U>Fsgrep /
map <S-F10>		:<C-U>new\|setlocal bufhidden=wipe buftype=nofile noswapfile\|0read!
map <F11>		:<C-U>BuffergatorToggle<cr>
map <F12>		:<C-U>NERDTreeToggle<cr>
" }}}
" {{{ [Mappings] Leader key sequences (buffers, commands & macros, calculator, Git)
map <Leader>;		@q
map <Leader><Tab>	:<C-U>TmuxNavigateDown<cr>
map <Leader>a		:<C-U>bp<cr>
map <Leader>c		:<C-U>Calc<cr>
map <Leader>C		:<C-U>cwindow<cr>
map <Leader>d		:<C-U>Ghdiffsplit<cr>
map <Leader>f		:<C-U>bn<cr>
map <Leader>h		:<C-U>let x = systemlist("sed -ne '/^map/!d' -e '/map <[eE]sc>/d' -e 'p' ~/.vimrc")\|call setbufvar(winbufnr(popup_dialog(x, #{ highlight: 'WildMenu', time: 2500 } )), '&filetype', 'vim')<cr><cr>
map <Leader>l		:<C-U>new\|setlocal bufhidden=wipe buftype=nofile filetype=git noswapfile\|0read!git log<cr>1G
map <Leader>p		J<Esc>:s/\t/ /g<cr>:s/ \+/ /g<cr>:s/( /(/<cr>:s/ \* / */g<cr>:s/$/;/<cr>
map <Leader>s		:<C-U>Gstatus<cr>
map <Leader>v		:<C-U>source ~/.vimrc<cr>
map <Leader>w		:<C-U>set invwrap<cr>
map <Leader>x		:<C-U>syntax on<cr>
" }}}
" {{{ [Mappings] Tab & window management
map <C-h>		:<C-U>tabprev<cr>|		" Go to previous tab page w/ wraparound
map <C-j>		:<C-U>wincmd j<cr>|		" Move to 1st window below current
map <C-k>		:<C-U>wincmd k<cr>|		" Move to 1st window above current
map <C-l>		:<C-U>tabnext<cr>|		" Go to next tab page w/ wraparound
map <C-o>		:<C-U>wincmd l<cr>|		" Move to 1st window right of current
map <C-s>		:<C-U>wincmd s<cr>|		" Split current window in two
map <C-t>		:<C-U>wincmd T<cr>|		" Move window to new tab page
map <C-y>		:<C-U>wincmd h<cr>|		" Move to 1st window left of current
" }}}

" vim:filetype=vim noexpandtab sw=8 ts=8 tw=0
